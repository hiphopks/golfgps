<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>골프 캐디 GPS 도우미</title>
  <style>
    body { font-family: sans-serif; padding: 1rem; }
    label, input, button, select { display: block; margin: 0.5rem 0; }
    .output { margin-top: 1rem; padding: 1rem; border: 1px solid #ccc; border-radius: 10px; }
  </style>
</head>
<body>
  <h2>골프 캐디 GPS 도우미 - Glyfada Golf Club</h2>

  <button onclick="getLocationAndCalculate()">현재 위치로 자동 홀 인식 및 거리 계산</button>
  <div id="current"></div>
  <div class="output" id="result"></div>

  <script>
    let currentLat = null;
    let currentLng = null;

    const teeCoords = {};

    function getLocationAndCalculate() {
      if (navigator.geolocation) {
        navigator.geolocation.getCurrentPosition(position => {
          currentLat = position.coords.latitude;
          currentLng = position.coords.longitude;
          document.getElementById("current").innerText = `현재 위치: 위도 ${currentLat}, 경도 ${currentLng}`;
          findNearestTeeAndCalculate();
        }, error => {
          alert("위치 정보를 가져올 수 없습니다: " + error.message);
        });
      } else {
        alert("이 브라우저는 GPS를 지원하지 않습니다.");
      }
    }

    function toRadians(deg) {
      return deg * Math.PI / 180;
    }

    function calculateDistance(lat1, lng1, lat2, lng2) {
      const R = 6371e3;
      const φ1 = toRadians(lat1);
      const φ2 = toRadians(lat2);
      const Δφ = toRadians(lat2 - lat1);
      const Δλ = toRadians(lng2 - lng1);

      const a = Math.sin(Δφ/2) * Math.sin(Δφ/2) +
                Math.cos(φ1) * Math.cos(φ2) *
                Math.sin(Δλ/2) * Math.sin(Δλ/2);
      const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a));
      return R * c;
    }

    function findNearestTeeAndCalculate() {
      const holeAreas = {
        1: [ [37.8761785, 23.7445943], [37.8730705, 23.7452166] ],
        2: [ [37.8726545, 23.7453905], [37.8699951, 23.7457767] ],
        3: [ [37.8699359, 23.7460556], [37.8716297, 23.7468067], [37.8722818, 23.7478474], [37.8728831, 23.7490705] ],
        4: [ [37.8727731, 23.7495532], [37.8717144, 23.7488773], [37.8715111, 23.7486949], [37.8714349, 23.7488237], [37.8714095, 23.7484053], [37.8711385, 23.7486306], [37.8711216, 23.74818], [37.8709183, 23.7481907], [37.8708421, 23.7482121], [37.8708251, 23.7478152], [37.8706558, 23.7478044], [37.8704864, 23.7478582] ],
        5: [ [37.8700629, 23.7473002], [37.8705372, 23.7472895], [37.870588, 23.7474504], [37.8708675, 23.7473646], [37.8709606, 23.7475684], [37.8711131, 23.7474289], [37.8711385, 23.747665], [37.8713841, 23.747504], [37.8712655, 23.7478152], [37.871401, 23.7477615] ],
        6: [ [37.8705248, 23.7455152], [37.8699843, 23.7447954], [37.8693011, 23.7450115], [37.8688525, 23.7447202] ],
        7: [ [37.8688391, 23.7447403], [37.8692141, 23.7451539], [37.869402, 23.7454811], [37.8695292, 23.7456755], [37.8697712, 23.7459837], [37.8700727, 23.7464527] ],
        8: [ [37.8700473, 23.7466888], [37.8697736, 23.7462703], [37.8695432, 23.7459986], [37.8691905, 23.7455924], [37.8689888, 23.7453763], [37.8686092, 23.7449388] ],
        9: [ [37.8686054, 23.7449119], [37.8690844, 23.7453962], [37.869401, 23.7457226], [37.8697121, 23.7460606], [37.8700535, 23.7463759] ]
      };

      let nearestHole = null;
      for (const [hole, polygon] of Object.entries(holeAreas)) {
        if (isInsidePolygon(polygon, [currentLat, currentLng])) {
          nearestHole = hole;
          break;
        }
      }

      if (nearestHole) {
        document.getElementById("result").innerHTML = `현재 위치는 ${nearestHole}번홀 내에 있습니다.`;
      } else {
        document.getElementById("result").innerHTML = `현재 위치가 어떤 홀 내부에도 없습니다.`;
      }
    }

    
    }
  function isInsidePolygon(polygon, point) {
  let x = point[1], y = point[0];
  let inside = false;
  for (let i = 0, j = polygon.length - 1; i < polygon.length; j = i++) {
    const xi = polygon[i][1], yi = polygon[i][0];
    const xj = polygon[j][1], yj = polygon[j][0];

    const intersect = ((yi > y) !== (yj > y)) &&
      (x < (xj - xi) * (y - yi) / (yj - yi) + xi);
    if (intersect) inside = !inside;
  }
  return inside;
}
</script>
</body>
</html>
