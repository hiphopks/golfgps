<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>골프 캐디 GPS 도우미</title>
  <style>
    body { font-family: sans-serif; padding: 1rem; }
    label, input, button, select { display: block; margin: 0.5rem 0; }
    .output { margin-top: 1rem; padding: 1rem; border: 1px solid #ccc; border-radius: 10px; }
  </style>
</head>
<body>
  <h2>골프 캐디 GPS 도우미 - Glyfada Golf Club</h2>

  <button id="checkHole">현재 위치로 자동 홀 인식 및 거리 계산</button>
  <div id="current"></div>
  <div class="output" id="result"></div>

  <script>
    let currentLat = null;
    let currentLng = null;
     // 티박스 사용 안함

    function getLocationAndCalculate() {
      if (navigator.geolocation) {
        navigator.geolocation.getCurrentPosition(position => {
          currentLat = position.coords.latitude;
          currentLng = position.coords.longitude;
          document.getElementById("current").innerText = `현재 위치: 위도 ${currentLat}, 경도 ${currentLng}`;
          findNearestTeeAndCalculate();
        }, error => {
          alert("위치 정보를 가져올 수 없습니다: " + error.message);
        });
      } else {
        alert("이 브라우저는 GPS를 지원하지 않습니다.");
      }
    }

    function toRadians(deg) {
      return deg * Math.PI / 180;
    }

    function calculateDistance(lat1, lng1, lat2, lng2) {
      const R = 6371e3;
      const φ1 = toRadians(lat1);
      const φ2 = toRadians(lat2);
      const Δφ = toRadians(lat2 - lat1);
      const Δλ = toRadians(lng2 - lng1);

      const a = Math.sin(Δφ/2) * Math.sin(Δφ/2) +
                Math.cos(φ1) * Math.cos(φ2) *
                Math.sin(Δλ/2) * Math.sin(Δλ/2);
      const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a));
      return R * c;
    }

    function findNearestTeeAndCalculate() {
      const holeAreas = {
        1: [ [37.8761785, 23.7445943], [37.8730705, 23.7452166] ],
        2: [ [37.8726545, 23.7453905], [37.8699951, 23.7457767] ],
        3: [ [37.8699359, 23.7460556], [37.8716297, 23.7468067], [37.8722818, 23.7478474], [37.8728831, 23.7490705] ],
        4: [ [37.8727731, 23.7495532], [37.8717144, 23.7488773], [37.8715111, 23.7486949], [37.8714349, 23.7488237], [37.8714095, 23.7484053], [37.8711385, 23.7486306], [37.8711216, 23.74818], [37.8709183, 23.7481907], [37.8708421, 23.7482121], [37.8708251, 23.7478152], [37.8706558, 23.7478044], [37.8704864, 23.7478582] ],
        5: [ [37.8700629, 23.7473002], [37.8705372, 23.7472895], [37.870588, 23.7474504], [37.8708675, 23.7473646], [37.8709606, 23.7475684], [37.8711131, 23.7474289], [37.8711385, 23.747665], [37.8713841, 23.747504], [37.8712655, 23.7478152], [37.871401, 23.7477615] ],
        6: [ [37.8705248, 23.7455152], [37.8699843, 23.7447954], [37.8693011, 23.7450115], [37.8688525, 23.7447202] ],
        7: [ [37.8688391, 23.7447403], [37.8692141, 23.7451539], [37.869402, 23.7454811], [37.8695292, 23.7456755], [37.8697712, 23.7459837], [37.8700727, 23.7464527] ],
        8: [ [37.8700473, 23.7466888], [37.8697736, 23.7462703], [37.8695432, 23.7459986], [37.8691905, 23.7455924], [37.8689888, 23.7453763], [37.8686092, 23.7449388] ],
        9: [ [37.8686054, 23.7449119], [37.8690844, 23.7453962], [37.869401, 23.7457226], [37.8697121, 23.7460606], [37.8700535, 23.7463759] ],
        10: [ [37.8763472, 23.744882], [37.8759745, 23.7451503], [37.8756866, 23.7452361], [37.8756104, 23.7454936], [37.8753902, 23.7455043], [37.8751446, 23.7457511], [37.875043, 23.7456438], [37.8747381, 23.7458154], [37.8746111, 23.7459227], [37.8744163, 23.7458691], [37.8740521, 23.7459764], [37.873815, 23.7461266], [37.8736202, 23.7458905], [37.8733407, 23.7458905], [37.8732137, 23.7459442], [37.8730697, 23.7460515], [37.8728749, 23.7459227], [37.8727818, 23.7458691], [37.8726463, 23.7459871], [37.8725954, 23.7460622] ],
        11: [ [37.8723752, 23.7463519], [37.8728749, 23.7469956], [37.8731629, 23.7476072], [37.8734254, 23.7484977], [37.873527, 23.7489375], [37.8736541, 23.7496564] ],
        12: [ [37.8738489, 23.7503216], [37.8739759, 23.749474], [37.8740098, 23.7490019], [37.8739505, 23.7485406], [37.8740182, 23.7482831] ],
        13: [ [37.8742808, 23.7476501], [37.875314, 23.7480149], [37.8756697, 23.7481972], [37.8759661, 23.748444], [37.8765589, 23.7486908], [37.8768129, 23.7488946], [37.8770247, 23.7489483] ],
        14: [ [37.8768468, 23.7482831], [37.8766012, 23.7480149], [37.8759999, 23.7476608], [37.8751615, 23.7472317], [37.8745602, 23.7471673], [37.8741029, 23.7471136], [37.8738319, 23.7471029], [37.873544, 23.7470707] ],
        15: [ [37.8735292, 23.7472657], [37.8738321, 23.7473539], [37.8744218, 23.7473743], [37.8750686, 23.7474748], [37.8754677, 23.7476856], [37.8757449, 23.7478124], [37.8759653, 23.7480837], [37.8762106, 23.7482085], [37.876519, 23.7483143], [37.8767913, 23.7484938] ],
        16: [ [37.876806, 23.7485856], [37.8765765, 23.7486059], [37.8762448, 23.7485543], [37.8757449, 23.7483597], [37.8754285, 23.7482936], [37.8751113, 23.7481796], [37.874697, 23.7480174], [37.8743715, 23.7479736] ],
        17: [ [37.8743753, 23.747835], [37.8746861, 23.7478775], [37.8752437, 23.7481343], [37.8756668, 23.7484082], [37.8759731, 23.7486972], [37.8762784, 23.7489176], [37.8765409, 23.7490501], [37.8768482, 23.7492393], [37.8771043, 23.7492821] ],
        18: [ [37.8771444, 23.7491026], [37.8768371, 23.7489135], [37.8766253, 23.7488546], [37.8763201, 23.7487316], [37.8762106, 23.748689], [37.8758605, 23.7485244], [37.8754837, 23.7484351], [37.8751519, 23.7483676], [37.8748486, 23.7483158], [37.8744225, 23.7482948] ]
      };

      let nearestHole = null;
      for (const [hole, polygon] of Object.entries(holeAreas)) {
        if (isInsidePolygon(polygon, [currentLat, currentLng])) {
          nearestHole = hole;
          break;
        }
      }

      if (nearestHole) {
        const greenCenters = {
          1: [37.872972, 23.745222],
          2: [37.869878, 23.745752],
          3: [37.872799, 23.749097],
          4: [37.870508, 23.747861],
          5: [37.871353, 23.747702],
          6: [37.868245, 23.745087],
          7: [37.872509, 23.744781],
          8: [37.872088, 23.743959],
          9: [37.875741, 23.744238],
          10: [37.872698, 23.745887],
          11: [37.873634, 23.749619],
          12: [37.874012, 23.748292],
          13: [37.877053, 23.749069],
          14: [37.873509, 23.747084],
          15: [37.876446, 23.745403],
          16: [37.876524, 23.746613],
          17: [37.877746, 23.749302],
          18: [37.876899, 23.745765]
        };

        const [greenLat, greenLng] = greenCenters[nearestHole];
        const meters = calculateDistance(currentLat, currentLng, greenLat, greenLng);
        const yards = (meters * 1.09361).toFixed(1);

        document.getElementById("result").innerHTML = `현재 위치는 ${nearestHole}번홀 내에 있습니다.
그린까지 거리: ${yards} 야드`;
      } else {
        const meters = calculateDistance(currentLat, currentLng, 37.872972, 23.745222);
        const yards = (meters * 1.09361).toFixed(1);
        document.getElementById("result").innerHTML = `현재 위치가 어떤 홀 내부에도 없습니다.<br>1번홀 그린까지 거리: <strong>${yards} 야드</strong>`; 
      }
    }

    function isInsidePolygon(polygon, point) {
      let x = point[1], y = point[0];
      let inside = false;
      for (let i = 0, j = polygon.length - 1; i < polygon.length; j = i++) {
        const xi = polygon[i][1], yi = polygon[i][0];
        const xj = polygon[j][1], yj = polygon[j][0];

        const intersect = ((yi > y) !== (yj > y)) &&
          (x < (xj - xi) * (y - yi) / (yj - yi) + xi);
        if (intersect) inside = !inside;
      }
      return inside;
    }
  document.addEventListener('DOMContentLoaded', () => {
  document.getElementById('checkHole').addEventListener('click', getLocationAndCalculate);
});
</script>
</body>
</html>
